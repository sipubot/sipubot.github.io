function GameImages(){this.keyboardImageCode=["iVBORw0KGgoAAAANSUhEUgAAAFAAAAAqBAMAAADWhsE5AAAAG1BMVEXX19fm5uYAAAD09PSqqqq8vLz///84ODisrKx1VPgwAAAAzklEQVQ4y8WVQQrCMBBFB3qCCKJLGVpwawNeYOYC4qJrF71Ab6Ant5k2M4KEyS6fHwKfD+VNUgLXUKUPvOuKZwjPeE9LfYxxzn5pGiD0TOECnfoAMGbfNG1bXHBIS31CnLIfmq7FOtUXZY6eo8zRQArumZlaFmWOnhEHofax99vD5H6b2hYXdLGV2mNWaiZn3kytikrtMWfqpLlso07Kf+ifWURti0KFU9lGLec5b5vJUqOmdY0y9l91eyon0q5oNxynbTNZKtTVz0f1g/QFvZHa0OlzTEYAAAAASUVORK5CYII="],
this.keycapList=["iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAD///9VVVUAAACqqqpggSv+AAAAAXRSTlMAQObYZgAAAEtJREFUCNd1jcENgDAMAy02cJsBaMIAICbI/kthRc2Te1nWycbhBXAlhZ1wqxBYybHIgDPnsxsFNXIsdyP+nNnOaKeW+yv6/QbeAh/+7w6qn7DhWwAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAD///9VVVUAAACqqqpggSv+AAAAAXRSTlMAQObYZgAAAExJREFUCNd1y8ENwCAMA8CIDVxlgOIwQCsmyP5LkUTwxB9bJ1kyJKubQ98aCrUtsIsgpZEdKUOj/pDuOUKoeI7YPFKv4cC+Vz6RWZEFlLYLYltjut4AAAAASUVORK5CYII=","iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAD///9VVVUAAACqqqpggSv+AAAAAXRSTlMAQObYZgAAADhJREFUCNdjIAYwKYGBA4OiIBgoM6iAaRFlBkVnY0EhiIihkpAiSMTRUMlJEUkNQheTMRgY4LEKACepCGT9ISzjAAAAAElFTkSuQmCC"];
}function Game(){this.config={bombRate:.3,bombMinVelocity:50,bombMaxVelocity:50,invaderInitialVelocity:25,invaderAcceleration:0,invaderDropDistance:20,rocketVelocity:120,
rocketMaxFireRate:2,gameWidth:400,gameHeight:300,fps:50,debugMode:!1,invaderRanks:1,invaderFiles:10,shipSpeed:120,levelDifficultyMultiplier:.2,pointsPerInvader:5
},this.width=0,this.height=0,this.gameBounds={left:0,top:0,right:0,bottom:0},this.intervalId=0,this.score=0,this.stage=0,this.stageName=["ASSEMBLY","C","JAVA","JAVASCRIPT"],
this.level=1,this.stateStack=[],this.pressedKeys={},this.gameCanvas=null,this.sounds=null,this.backgroundScreen=null}function GameLoop(t){var e=t.currentState();if(e){
var i=1/t.config.fps,s=this.gameCanvas.getContext("2d");e.update&&e.update(t,i),e.draw&&e.draw(t,i,s)}}function WelcomeState(){}function GameOverState(){}function PlayState(t,e){
this.config=t,this.level=e,this.invaderCurrentVelocity=10,this.invaderCurrentDropDistance=0,this.invadersAreDropping=!1,this.lastRocketTime=null,this.ship=null,this.invaders=[],
this.rockets=[],this.bombs=[],this.boss={},this.bossbombs=[],this.bossexplosion=[]}function PauseState(){}function LevelIntroState(t){this.level=t,this.countdownMessage="3",
this.IntroStageWord="This is Just Game"}function Ship(t,e){this.x=t,this.y=e,this.width=80,this.height=42,this.hp=100,this.inithp=100}function Rocket(t,e,i){this.x=t,
this.y=e,this.velocity=i}function Bomb(t,e,i){this.x=t,this.y=e,this.velocity=i}function BossBomb(t,e,i,s){this.x=t,this.y=e,this.direction=i,this.velocity=s}function ExplosionBoss(t,e,i,s){
this.x=t,this.y=e,this.direction=i,this.velocity=s}function Invader(t,e,i,s,o){this.x=t,this.y=e,this.rank=i,this.file=s,this.type=o,this.width=18,this.height=14;
}function Boss(t,e,i){this.x=t,this.y=e,this.stage=i,this.hp=1e3,this.movedirection=-1,this.width=80,this.height=40}function GameState(t,e,i,s,o,n){this.updateProc=t,
this.drawProc=e,this.keyDown=i,this.keyUp=s,this.enter=o,this.leave=n}function Sounds(){this.audioContext=null,this.sounds={}}GameImages.prototype.keyboard=function(){
var t=new Image;t.src="data:image/png;base64,"+this.keyboardImageCode,this.keyboard=t},GameImages.prototype.keycaps=function(){var t=Object(this),e=[];t.keycapList.map(function(t,i){
var s=new Image;s.src="data:image/png;base64,"+t,e.push(s)}),this.keycaps=e};var gameImages=new GameImages;gameImages.keyboard(),gameImages.keycaps(),Game.prototype.initialise=function(t){
this.gameCanvas=t,this.width=t.width,this.height=t.height,this.gameBounds={left:t.width/2-this.config.gameWidth/2,right:t.width/2+this.config.gameWidth/2,top:t.height/2-this.config.gameHeight/2,
bottom:t.height/2+this.config.gameHeight/2}},Game.prototype.moveToState=function(t){this.currentState()&&this.currentState().leave&&(this.currentState().leave(game),
this.stateStack.pop()),t.enter&&t.enter(game),this.stateStack.pop(),this.stateStack.push(t)},Game.prototype.start=function(){this.moveToState(new WelcomeState),this.config.debugMode=/debug=true/.test(window.location.href);
var t=this;this.intervalId=setInterval(function(){GameLoop(t)},1e3/this.config.fps)},Game.prototype.currentState=function(){return this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;
},Game.prototype.mute=function(t){t===!0?this.sounds.mute=!0:t===!1?this.sounds.mute=!1:this.sounds.mute=!this.sounds.mute},Game.prototype.pushState=function(t){
t.enter&&t.enter(game),this.stateStack.push(t)},Game.prototype.popState=function(){this.currentState()&&(this.currentState().leave&&this.currentState().leave(game),
this.stateStack.pop())},Game.prototype.stop=function(){clearInterval(this.intervalId)},Game.prototype.keyDown=function(t){this.pressedKeys[t]=!0,this.currentState()&&this.currentState().keyDown&&this.currentState().keyDown(this,t);
},Game.prototype.keyUp=function(t){delete this.pressedKeys[t],this.currentState()&&this.currentState().keyUp&&this.currentState().keyUp(this,t)},WelcomeState.prototype.enter=function(t){
t.sounds=new Sounds,t.sounds.init(),t.sounds.loadSound("shoot","sounds/shoot.wav"),t.sounds.loadSound("bang","sounds/bang.wav"),t.sounds.loadSound("explosion","sounds/explosion.wav");
},WelcomeState.prototype.update=function(t,e){},WelcomeState.prototype.draw=function(t,e,i){i.clearRect(0,0,t.width,t.height),i.font="30px Arial",i.fillStyle="#ffffff",
i.textBaseline="center",i.textAlign="center",i.fillText("Code Invaders",t.width/2,t.height/2-40),i.font="16px Arial",i.fillText("Select Stage",t.width/2,t.height/2),
t.stageName.map(function(e,s){t.stage===s?(i.strokeStyle="#ffffff",i.fillStyle="#ffffff"):(i.strokeStyle="#999999",i.fillStyle="#999999"),i.strokeRect(t.width/2-255+130*s,t.height/2+300,120,60),
i.fillText(t.stageName[s],t.width/2-195+130*s,t.height/2+335,120,60)})},WelcomeState.prototype.keyDown=function(t,e){32==e&&(t.level=1,t.score=0,t.moveToState(new LevelIntroState(t.level))),
37==e&&t.stage>0&&t.stage--,39==e&&t.stage<3&&t.stage++},GameOverState.prototype.update=function(t,e){},GameOverState.prototype.draw=function(t,e,i){i.clearRect(0,0,t.width,t.height),
i.font="30px Arial",i.fillStyle="#ffffff",i.textBaseline="center",i.textAlign="center",i.fillText("Game Over!",t.width/2,t.height/2-40),i.font="16px Arial",i.fillText("You scored "+t.score+" and got to level "+t.level,t.width/2,t.height/2),
i.font="16px Arial",i.fillText("Press 'Space' to play again.",t.width/2,t.height/2+40)},GameOverState.prototype.keyDown=function(t,e){32==e&&(t.score=0,t.level=1,
t.moveToState(new LevelIntroState(1)))},PlayState.prototype.enter=function(t){this.ship=new Ship(t.width/2,t.gameBounds.bottom),this.invaderCurrentVelocity=10,this.invaderCurrentDropDistance=0,
this.invadersAreDropping=!1;var e=this.level*this.config.levelDifficultyMultiplier;this.shipSpeed=this.config.shipSpeed,this.invaderInitialVelocity=this.config.invaderInitialVelocity+e*this.config.invaderInitialVelocity,
this.bombRate=this.config.bombRate+e*this.config.bombRate,this.bombMinVelocity=this.config.bombMinVelocity+e*this.config.bombMinVelocity,this.bombMaxVelocity=this.config.bombMaxVelocity+e*this.config.bombMaxVelocity;
for(var i=this.config.invaderRanks,s=this.config.invaderFiles,o=[],n=0;n<i;n++)for(var h=0;h<s;h++)o.push(new Invader(t.width/2+200*(s/2-h)/s,t.gameBounds.top-20*n-100,n,h,"Invader"));
this.invaders=o,this.invaderCurrentVelocity=this.invaderInitialVelocity,this.invaderVelocity={x:-this.invaderInitialVelocity,y:0},this.invaderNextVelocity=null;var a=new Boss(t.width/2,200,t.stage);
this.boss=a,this.endcount=0},PlayState.prototype.update=function(t,e){var i=Object(this);t.pressedKeys[37]&&(this.ship.x-=this.shipSpeed*e),t.pressedKeys[39]&&(this.ship.x+=this.shipSpeed*e),
t.pressedKeys[32]&&this.fireRocket(),this.ship.x<t.gameBounds.left&&(this.ship.x=t.gameBounds.left),this.ship.x>t.gameBounds.right&&(this.ship.x=t.gameBounds.right),
this.bombs.map(function(t,s){t.y+=e*t.velocity,t.y>i.height&&i.bombs.splice(s--,1)}),this.rockets.map(function(t,s){t.y-=e*t.velocity,t.y<0&&i.rockets.splice(s--,1);
});var s=!1,o=!1,n=!1;this.invaders.map(function(h){var a=h.x+i.invaderVelocity.x*e,l=h.y+i.invaderVelocity.y*e;s===!1&&a<t.gameBounds.left?s=!0:o===!1&&a>t.gameBounds.right?o=!0:n===!1&&l>t.gameBounds.bottom&&(n=!0),
s||o||n||(h.x=a,h.y=l)}),s&&(this.invaderCurrentVelocity+=this.config.invaderAcceleration,this.invaderVelocity={x:this.invaderCurrentVelocity,y:0}),o&&(this.invaderCurrentVelocity+=this.config.invaderAcceleration,
this.invaderVelocity={x:-this.invaderCurrentVelocity,y:0}),this.boss.x>400&&(this.boss.movedirection=1),this.boss.x<200&&(this.boss.movedirection=-1),this.boss.x=this.boss.x-e*this.boss.movedirection*30,
this.bossbombs.map(function(s,o){switch(s.direction){case 0:s.y+=e*s.velocity,s.x-=e*s.velocity;break;case 1:s.y+=e*s.velocity;break;case 2:s.y+=e*s.velocity,s.x+=e*s.velocity;
}(s.y>t.height||s.x>t.width||s.x<0||s.y<0)&&i.bossbombs.splice(o--,1)}),this.bossexplosion.map(function(t,i){switch(t.direction){case 0:t.y+=e*t.velocity,t.x-=e*t.velocity;
break;case 1:t.y+=e*t.velocity;break;case 2:t.y+=e*t.velocity,t.x+=e*t.velocity;break;case 3:t.y-=e*t.velocity,t.x-=e*t.velocity;break;case 4:t.y-=e*t.velocity;break;
case 5:t.y-=e*t.velocity,t.x+=e*t.velocity}}),this.invaders.map(function(e,s){var o=!1;i.rockets.map(function(s,n){s.x>=e.x-e.width/2&&s.x<=e.x+e.width/2&&s.y>=e.y-e.height/2&&s.y<=e.y+e.height/2&&(i.rockets.splice(n--,1),
o=!0,t.score+=i.config.pointsPerInvader)}),o&&(i.invaders.splice(s--,1),t.sounds.playSound("bang"))});var h=i.boss,a=!1;this.rockets.map(function(e,s){e.x>=h.x-h.width/2&&e.x<=h.x+h.width/2&&e.y>=h.y-h.height/2&&e.y<=h.y+h.height/2&&(i.rockets.splice(s--,1),
a=!0,t.score+=i.config.pointsPerInvader)}),a&&(this.boss.hp=i.boss.hp-20,i.boss.hp<0&&(this.boss.hp=0),t.sounds.playSound("bang")),i.boss.hp>0&&0===i.bossbombs.length&&(i.bossbombs.push(new BossBomb(i.boss.x,i.boss.y+i.boss.height/2,0,i.bombMinVelocity+Math.random()*(i.bombMaxVelocity-i.bombMinVelocity))),
i.bossbombs.push(new BossBomb(i.boss.x,i.boss.y+i.boss.height/2,1,i.bombMinVelocity+Math.random()*(i.bombMaxVelocity-i.bombMinVelocity))),i.bossbombs.push(new BossBomb(i.boss.x,i.boss.y+i.boss.height/2,2,i.bombMinVelocity+Math.random()*(i.bombMaxVelocity-i.bombMinVelocity))));
var l={};if(this.invaders.map(function(t){(!l[t.file]||l[t.file].rank<t.rank)&&(l[t.file]=t)}),Object.keys(l).map(function(t,s){var o=i.bombRate*e;o>Math.random()&&i.bombs.push(new Bomb(l[t].x,l[t].y+l[t].height/2,i.bombMinVelocity+Math.random()*(i.bombMaxVelocity-i.bombMinVelocity)));
}),this.bombs.map(function(e,s){e.x>=i.ship.x-i.ship.width/2&&e.x<=i.ship.x+i.ship.width/2&&e.y>=i.ship.y-i.ship.height/2&&e.y<=i.ship.y+i.ship.height/2&&(i.bombs.splice(s--,1),
i.ship.hp--,t.sounds.playSound("explosion"))}),this.bossbombs.map(function(e,s){e.x>=i.ship.x-i.ship.width/2&&e.x<=i.ship.x+i.ship.width/2&&e.y>=i.ship.y-i.ship.height/2&&e.y<=i.ship.y+i.ship.height/2&&(i.bossbombs.splice(s--,1),
i.ship.hp--,t.sounds.playSound("explosion"))}),i.ship.hp<=0&&(t.moveToState(new GameOverState),i.ship.hp=i.ship.inithp),0===i.boss.hp&&0===this.endcount){this.bossbombs=[],
this.bombs=[];for(var c=0;c<6;c++)i.bossexplosion.push(new ExplosionBoss(i.boss.x,i.boss.y+i.boss.height/2,c,i.bombMinVelocity+Math.random()*(i.bombMaxVelocity-i.bombMinVelocity)));
}0===i.boss.hp&&(this.endcount+=1),0===i.boss.hp&&200===this.endcount&&(i.bossexplosion=[],t.score+=50*i.level,t.level+=1,t.moveToState(new LevelIntroState(t.level)));
},PlayState.prototype.draw=function(t,e,i){var s=Object(this);i.clearRect(0,0,t.width,t.height),i.fillStyle="#999999",i.fillRect(this.ship.x-this.ship.width/2,this.ship.y-this.ship.height/2,this.ship.width,this.ship.height),
i.drawImage(gameImages.keyboard,this.ship.x-this.ship.width/2,this.ship.y-this.ship.height/2,80,42),i.fillStyle="#006600",this.invaders.map(function(t){i.fillText("Test",t.x,t.y),
i.fillRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height)});var o=this.boss;this.boss.hp>0&&(i.fillStyle="rgb(255,"+Math.floor(o.hp/4).toString()+",11)",i.fillRect(o.x-o.width/2,o.y-o.height/2,o.width,o.height)),
i.fillStyle="#00ffff",this.bossbombs.map(function(t){i.fillRect(t.x-2,t.y-2,6,6)}),i.fillStyle="#00ffff",this.bossexplosion.map(function(t){i.fillRect(t.x-2,t.y-2,20,10);
}),i.fillStyle="#ff5555",this.bombs.map(function(t){i.fillRect(t.x-2,t.y-2,4,4)}),i.fillStyle="#ff0000",this.rockets.map(function(t){i.fillRect(t.x,t.y-2,8,8),i.drawImage(gameImages.keycaps[0],t.x,t.y-2,8,8);
});var n=t.gameBounds.bottom+(t.height-t.gameBounds.bottom)/2+7;i.fillStyle="#dddddd",i.strokeRect(t.gameBounds.left,n-1,2*s.ship.inithp,7),i.fillStyle="rgb(255,"+2*s.ship.hp+",0)",
i.fillRect(t.gameBounds.left,n,2*s.ship.hp,5),i.fillStyle="#ffffff",i.font="14px Arial",info="Score: "+t.score+", Level: "+t.level,i.textAlign="right",i.fillText(info,t.gameBounds.right,n),
this.config.debugMode&&(i.strokeStyle="#ff0000",i.strokeRect(0,0,t.width,t.height),i.strokeRect(t.gameBounds.left,t.gameBounds.top,t.gameBounds.right-t.gameBounds.left,t.gameBounds.bottom-t.gameBounds.top));
},PlayState.prototype.keyDown=function(t,e){32==e&&this.fireRocket(),80==e&&t.pushState(new PauseState)},PlayState.prototype.keyUp=function(t,e){},PlayState.prototype.fireRocket=function(){
(null===this.lastRocketTime||(new Date).valueOf()-this.lastRocketTime>1e3/this.config.rocketMaxFireRate)&&(this.rockets.push(new Rocket(this.ship.x,this.ship.y-12,this.config.rocketVelocity)),
this.lastRocketTime=(new Date).valueOf(),game.sounds.playSound("shoot"))},PauseState.prototype.keyDown=function(t,e){80==e&&t.popState()},PauseState.prototype.draw=function(t,e,i){
i.clearRect(0,0,t.width,t.height),i.font="14px Arial",i.fillStyle="#ffffff",i.textBaseline="middle",i.textAlign="center",i.fillText("Paused",t.width/2,t.height/2);
},LevelIntroState.prototype.update=function(t,e){void 0===this.countdown&&(this.countdown=3),this.countdown-=e,this.countdown<2&&(this.countdownMessage="2"),this.countdown<1&&(this.countdownMessage="1"),
this.countdown<=0&&t.moveToState(new PlayState(t.config,this.level))},LevelIntroState.prototype.draw=function(t,e,i){void 0===this.count&&(this.count=0),this.count+=e*t.config.fps,
i.font="68px Arial",i.textBaseline="middle",i.fillStyle="#ffffff",i.textAlign="center",i.fillText(this.IntroStageWord,t.width/2,46*Math.ceil(this.count/10)),i.clearRect(t.width/2-120,t.height/2-60,240,160),
i.fillStyle="#111111",i.fillRect(t.width/2-120,t.height/2-60,240,160),i.font="36px Arial",i.fillStyle="#ffffff",i.textBaseline="middle",i.textAlign="center",i.fillText("Level "+this.level,t.width/2,t.height/2),
i.font="24px Arial",i.fillText("Ready in "+this.countdownMessage,t.width/2,t.height/2+36)},Sounds.prototype.init=function(){context=window.AudioContext||window.webkitAudioContext,
this.audioContext=new context,this.mute=!1},Sounds.prototype.loadSound=function(t,e){var i=this;this.sounds[t]=null;var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",
s.onload=function(){i.audioContext.decodeAudioData(s.response,function(e){i.sounds[t]={buffer:e}})};try{s.send()}catch(e){console.log("An exception occured getting sound the sound "+t+" this might be because the page is running from the file system, not a webserver."),
console.log(e)}},Sounds.prototype.playSound=function(t){if(void 0!==this.sounds[t]&&null!==this.sounds[t]&&this.mute!==!0){var e=this.audioContext.createBufferSource();
e.buffer=this.sounds[t].buffer,e.connect(this.audioContext.destination),e.start(0)}};